    <!-- Dark mode support: Code to be added just before end body tag in Theme HTML -->
    <div id='darkModeCode'/>

    <style>

    /* Floating icon button â€“ transparent look */
    #themePromptBtn {
      position: fixed;
      bottom: 12px;
      right: 12px;
      z-index: 9999;

      /* Transparent background */
      background: rgba(0, 0, 0, 0.25);

      color: rgba(1,1,1,.7);
      border: 1px solid rgba(255, 255, 255, 0.4);
      /* border: none; */
      border-radius: 50%;
      padding: 10px;
      /* width: 44px;
      height: 44px; */

      display: none; /* controlled by JS */
      cursor: pointer;
      /* font-size: 22px;
      line-height: 1; */
      text-align: center;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    /* Hover / active visual feedback */
    #themePromptBtn:hover {
      background: rgba(0, 0, 0, 0.35);
      transform: scale(1.05);
    }

    @media (prefers-color-scheme: dark) {
      body.darkmode-optin #themePromptBtn {
        background: rgba(255, 255, 255, 0.25);
        color: rgba(255, 255, 255, 0.7);
      }
    }

    /* SVG icon sizing */
    #themePromptBtn svg {
      width: 22px;
      height: 22px;
      stroke: rgba(255, 255, 255, 0.8);
      stroke-width: 1.6;
    }

    /* Modal overlay */
    #themeModalOverlay {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5);
      z-index: 10000;
    }

    /* Modal box */
    #themeModal {
      position: fixed;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      max-width: 90%;
    }

    /* Modal buttons */
    #themeModal button {
      margin: 6px 6px 0 0;
      padding: 6px 10px;
      cursor: pointer;
    }

    </style>

    <!-- Floating button -->
    <!-- <button id='themePromptBtn'>ðŸŒ“</button> -->
    <button id="themePromptBtn">
      <!-- Outline moon SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path
          d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
          stroke="currentColor"
        />
      </svg>
    </button>

    <!-- Modal -->
    <div id='themeModalOverlay'>
      <div id='themeModal'>
        <p>Please note that the dark mode feature for this blog has some limitations. Some elements of posts may not become dark (e.g., comments).</p>
        <form>
          <p>
            <input id='systemDarkMode' type='checkbox'/>
            <label for='systemDarkMode'>Follow System Light/Dark Mode Setting</label>
          </p>
          <p>
            <input id='showIconBtn' type='checkbox'/>
            <label for='showIconBtn'>Show Floating Button</label>
          </p>
          <button id='modalOK' type='button'>OK</button>
          <button id='modalCancel' type='button'>Cancel</button>
        </form>
      </div>
    </div>

    <script>
    // Default breakpoint for showing floating icon button
    const iconBreakpoint = 800;

    // Initialize settings from localStorage
    let darkModeEnabled = localStorage.getItem('darkModeEnabled') === 'true';
    let iconBtnVisible = localStorage.getItem('iconBtnVisible') === 'true';

    // Determine initial icon visibility based on window width
    function updateIconVisibility() {
      const btn = document.getElementById('themePromptBtn');
      const w = window.innerWidth;
      if (iconBtnVisible ?? (w >= iconBreakpoint)) {
        btn.style.display = 'block';
      } else {
        btn.style.display = 'none';
      }
    }

    // Apply dark mode if enabled
    function applyDarkMode() {
      const body = document.body;
      if (darkModeEnabled) {
        body.classList.add('darkmode-optin');
      } else {
        body.classList.remove('darkmode-optin');
      }
    }

    // Show modal and set checkboxes according to current settings
    function openModal(bottomRight=true) {
      const themeModalId = document.getElementById('themeModal')

      document.getElementById('themeModalOverlay').style.display = 'block';
      if (bottomRight) {
        themeModalId.style.top = 'auto';
        themeModalId.style.left = 'auto';
        themeModalId.style.bottom = '20px';
        themeModalId.style.right = '20px';
      } else {
        themeModalId.style.top = '20px';
        themeModalId.style.left = '20px';
        themeModalId.style.bottom = 'auto';
        themeModalId.style.right = 'auto';
      }
      document.getElementById("systemDarkMode").checked = !!darkModeEnabled;
      const w = window.innerWidth;
      const showDefault = iconBtnVisible ?? (w >= iconBreakpoint);

      document.getElementById("showIconBtn").checked = !!showDefault;
    }

    // Hide modal
    function closeModal() {
      document.getElementById('themeModalOverlay').style.display = 'none';
    }

    // OK button handler
    document.getElementById('modalOK').onclick = function() {
      darkModeEnabled = document.getElementById("systemDarkMode").checked;
      iconBtnVisible = document.getElementById("showIconBtn").checked;
      localStorage.setItem('darkModeEnabled', darkModeEnabled);
      localStorage.setItem('iconBtnVisible', iconBtnVisible);

      applyDarkMode();
      updateIconVisibility();
      closeModal();
    };

    // Cancel button handler
    document.getElementById('modalCancel').onclick = closeModal;

    // Floating button click opens modal
    document.getElementById('themePromptBtn').onclick = openModal;

    // You can also link a menu item to call openModal() for all breakpoints
    // Example: <a href='javascript:openModal()'>Dark Mode</a>

    // Initialize on page load
    window.addEventListener('load', () => {
      applyDarkMode();
      updateIconVisibility();
    });

    // Update icon visibility on window resize
    window.addEventListener('resize', updateIconVisibility);
    </script>
    