    <!-- Dark mode support: Code to be added just before end body tag in Theme HTML -->
    <div id='darkModeCode'/>

    <style>
    /* Floating icon button â€“ transparent look */
    #themePromptBtn {
      position: fixed;
      bottom: 12px;
      right: 12px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.25);
      color: rgba(1, 1, 1, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      padding: 10px;
      display: none;
      cursor: pointer;
      text-align: center;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    #themePromptBtn:hover {
      background: rgba(0, 0, 0, 0.35);
      transform: scale(1.05);
    }

    body.darkmode-optin #themePromptBtn {
      background: rgba(255, 255, 255, 0.25);
      color: rgba(255, 255, 255, 0.7);
    }

    #themePromptBtn svg {
      width: 22px;
      height: 22px;
      stroke: rgba(255, 255, 255, 0.8);
      stroke-width: 1.6;
    }

    #themeModalOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
    }

    #themeModal {
      position: fixed;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      max-width: 90%;
    }

    #themeModal button {
      margin: 6px 6px 0 0;
      padding: 6px 10px;
      cursor: pointer;
    }
    </style>

    <!-- Floating button -->
    <button id="themePromptBtn">
      <!-- Outline moon SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path
          d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
          stroke="currentColor"
        />
      </svg>
    </button>

    <!-- Modal -->
    <div id='themeModalOverlay'>
      <div id='themeModal'>
        <p>Please note that the dark mode feature for this blog has some limitations. Some elements of posts may not become dark (e.g., comments).</p>
        <form>
          <!-- CHANGED: replaced checkbox with dropdown -->
          <p>
            <label for='themeModeSelect'>Appearance Mode:</label><br />
            <select id='themeModeSelect'>
              <option value='light'>Light</option>
              <option value='dark'>Dark</option>
              <option value='device'>Device (System Default)</option>
            </select>
          </p>
          <p>
            <input id='showIconBtn' type='checkbox'/>
            <label for='showIconBtn'>Show Floating Button</label>
          </p>
          <button id='modalOK' type='button'>OK</button>
          <button id='modalCancel' type='button'>Cancel</button>
        </form>
      </div>
    </div>

    <script>
//<![CDATA[  
    // Default breakpoint for showing floating icon button
    const iconBreakpoint = 800;

    // Default mode is now 'light' (no dark code until user enables)
    let themeMode = localStorage.getItem('themeMode') || 'light';
    let iconBtnVisible = localStorage.getItem('iconBtnVisible') === 'true';

    function updateIconVisibility() {
      const btn = document.getElementById('themePromptBtn');
      const w = window.innerWidth;
      if (iconBtnVisible ?? (w >= iconBreakpoint)) {
        btn.style.display = 'block';
      } else {
        btn.style.display = 'none';
      }
    }

    function applyDarkMode() {
      const body = document.body;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (themeMode === 'dark' || (themeMode === 'device' && prefersDark)) {
        body.classList.add('darkmode-optin');
      } else {
        body.classList.remove('darkmode-optin');
      }
    }

    function openModal(bottomRight = true) {
      const themeModalId = document.getElementById('themeModal');
      document.getElementById('themeModalOverlay').style.display = 'block';

      if (bottomRight) {
        themeModalId.style.top = 'auto';
        themeModalId.style.left = 'auto';
        themeModalId.style.bottom = '20px';
        themeModalId.style.right = '20px';
      } else {
        themeModalId.style.top = '20px';
        themeModalId.style.left = '20px';
        themeModalId.style.bottom = 'auto';
        themeModalId.style.right = 'auto';
      }

      document.getElementById('themeModeSelect').value = themeMode;
      const w = window.innerWidth;
      const showDefault = iconBtnVisible ?? (w >= iconBreakpoint);
      document.getElementById('showIconBtn').checked = !!showDefault;
    }

    function closeModal() {
      document.getElementById('themeModalOverlay').style.display = 'none';
    }

    document.getElementById('modalOK').onclick = function () {
      themeMode = document.getElementById('themeModeSelect').value;
      iconBtnVisible = document.getElementById('showIconBtn').checked;

      localStorage.setItem('themeMode', themeMode);
      localStorage.setItem('iconBtnVisible', iconBtnVisible);

      applyDarkMode();
      updateIconVisibility();
      closeModal();
    };

    document.getElementById('modalCancel').onclick = closeModal;
    document.getElementById('themePromptBtn').onclick = openModal;

    window.addEventListener('load', () => {
      applyDarkMode();
      updateIconVisibility();
    });

    window.addEventListener('resize', updateIconVisibility);

    // Auto-update if OS theme changes while in "device" mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (themeMode === 'device') applyDarkMode();
    });
    // Uncomment below line after copying to Blogger HTML Theme editor to avoid ampersand character errors
//]]>
    </script>
    